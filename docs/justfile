# ZoteroPatch AI Reader - Docs Justfile
# æ–‡æ¡£ç›¸å…³çš„ä»»åŠ¡ç®¡ç†

# é»˜è®¤ä»»åŠ¡ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨
default: dev

# Show detailed help information
help:
    @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    @echo "â•‘         ZoteroPatch AI Reader - Docs Command Reference          â•‘"
    @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    @echo ""
    @echo "ğŸ“š DOCUMENTATION DEVELOPMENT"
    @echo "  just dev              - Start docs dev server (default)"
    @echo "  just build            - Build documentation"
    @echo "  just preview          - Preview built documentation"
    @echo ""
    @echo "ğŸ“¦ SETUP"
    @echo "  just install          - Install docs dependencies"
    @echo "  just setup            - Complete docs setup"
    @echo ""
    @echo "ğŸ§¹ MAINTENANCE"
    @echo "  just clean            - Clean build artifacts"
    @echo "  just clean-all        - Clean all (including node_modules)"
    @echo "  just format           - Format documentation files"
    @echo ""
    @echo "ğŸ” UTILITIES"
    @echo "  just check-links      - Check documentation links"
    @echo "  just spell-check      - Run spell checker"
    @echo "  just stats            - Show documentation statistics"
    @echo "  just search <term>    - Search documentation content"
    @echo ""
    @echo "ğŸ’¡ TIPS:"
    @echo "  â€¢ Run 'just' to start dev server immediately"
    @echo "  â€¢ Dev server runs at http://localhost:5173"
    @echo "  â€¢ Changes auto-reload in dev mode"
    @echo ""

# å®‰è£…æ–‡æ¡£ä¾èµ–
install:
    @echo "ğŸ“¦ Installing docs dependencies..."
    npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
dev:
    @echo "ğŸ“š Starting docs development server..."
    @echo "ğŸ’¡ Access at http://localhost:5173"
    npm run dev

# æ„å»ºæ–‡æ¡£
build:
    @echo "ğŸ“š Building docs..."
    npm run build

# é¢„è§ˆæ„å»ºç»“æœ
preview:
    @echo "ğŸ‘€ Previewing docs build..."
    npm run preview

# æ¸…ç†æ„å»ºäº§ç‰©
clean:
    @echo "ğŸ§¹ Cleaning docs build artifacts..."
    rm -rf .vitepress/dist .vitepress/cache

# æ¸…ç†æ‰€æœ‰ï¼ˆåŒ…æ‹¬ node_modulesï¼‰
clean-all: clean
    @echo "ğŸ§¹ Cleaning all..."
    rm -rf node_modules

# æ£€æŸ¥æ–‡æ¡£é“¾æ¥
check-links:
    @echo "ğŸ” Checking documentation links..."
    @find . -name "*.md" -type f -not -path "./node_modules/*" -not -path "./.vitepress/*" | \
        xargs grep -h "\[.*\](" | \
        grep -v "^#" | \
        wc -l | \
        xargs -I {} echo "Found {} markdown links"

# æ ¼å¼åŒ–æ–‡æ¡£
format:
    @echo "âœ¨ Formatting documentation..."
    npx prettier --write "**/*.{md,ts,json}"

# æ‹¼å†™æ£€æŸ¥ï¼ˆéœ€è¦å®‰è£… cspellï¼‰
spell-check:
    @echo "ğŸ“ Running spell check..."
    @if command -v cspell > /dev/null; then \
        npx cspell "**/*.md"; \
    else \
        echo "âš ï¸  cspell not installed, skipping..."; \
    fi

# æŸ¥çœ‹æ–‡æ¡£ç»Ÿè®¡
stats:
    @echo "ğŸ“Š Documentation Statistics"
    @echo "=========================="
    @echo "Total .md files: $(find . -name "*.md" -type f -not -path "./node_modules/*" -not -path "./.vitepress/*" | wc -l)"
    @echo "Total lines: $(find . -name "*.md" -type f -not -path "./node_modules/*" -not -path "./.vitepress/*" -exec cat {} \; | wc -l)"
    @echo "Guide pages: $(find ./guide -name "*.md" -type f 2>/dev/null | wc -l)"
    @echo "Development pages: $(find ./development -name "*.md" -type f 2>/dev/null | wc -l)"
    @echo "API pages: $(find ./api -name "*.md" -type f 2>/dev/null | wc -l)"

# æœç´¢æ–‡æ¡£å†…å®¹
search term:
    @echo "ğŸ” Searching for '{{term}}'..."
    @grep -r "{{term}}" . --include="*.md" --exclude-dir=node_modules --exclude-dir=.vitepress -n

# å¼€å‘å‰çš„å‡†å¤‡å·¥ä½œ
setup: install
    @echo "âœ… Documentation setup complete!"
    @echo "ğŸ’¡ Run 'just dev' to start the development server"

# å®Œæ•´çš„æ„å»ºå’Œé¢„è§ˆæµç¨‹
preview-build: build preview
    @echo "âœ… Build preview ready!"
